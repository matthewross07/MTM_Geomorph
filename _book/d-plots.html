<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 3D plots | Methods for: Identifying geomorphic process domains in synthetic landscapes of West Virginia, USA</title>
  <meta name="description" content="9 3D plots | Methods for: Identifying geomorphic process domains in synthetic landscapes of West Virginia, USA" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="9 3D plots | Methods for: Identifying geomorphic process domains in synthetic landscapes of West Virginia, USA" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 3D plots | Methods for: Identifying geomorphic process domains in synthetic landscapes of West Virginia, USA" />
  
  
  

<meta name="author" content="Dr. Matthew Ross and Dr. Kristin Jaeger" />
<meta name="author" content="matt.ross(at)colostate.edu" />


<meta name="date" content="2020-08-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="energy-index.html"/>
<link rel="next" href="table-of-stats-by-zone.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html"><i class="fa fa-check"></i><b>1</b> Terrain analyses using TauDEM</a><ul>
<li class="chapter" data-level="1.1" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html#pit-remove"><i class="fa fa-check"></i><b>1.1</b> Pit remove</a></li>
<li class="chapter" data-level="1.2" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html#d8"><i class="fa fa-check"></i><b>1.2</b> D8</a><ul>
<li class="chapter" data-level="1.2.1" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html#flow-direction-with-slope-and-flow-direction"><i class="fa fa-check"></i><b>1.2.1</b> Flow direction with slope and flow direction</a></li>
<li class="chapter" data-level="1.2.2" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html#flow-accumulation"><i class="fa fa-check"></i><b>1.2.2</b> Flow accumulation</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html#d-infinity"><i class="fa fa-check"></i><b>1.3</b> D-Infinity</a><ul>
<li class="chapter" data-level="1.3.1" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html#flowdir"><i class="fa fa-check"></i><b>1.3.1</b> Flowdir</a></li>
<li class="chapter" data-level="1.3.2" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html#flow-accumulation-1"><i class="fa fa-check"></i><b>1.3.2</b> Flow accumulation</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html#stream-detection"><i class="fa fa-check"></i><b>1.4</b> Stream detection</a><ul>
<li class="chapter" data-level="1.4.1" data-path="terrain-analyses-using-taudem.html"><a href="terrain-analyses-using-taudem.html#threshold-1000-pixels-0.1-km2"><i class="fa fa-check"></i><b>1.4.1</b> Threshold 1000 pixels = 0.1 km2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="identifying-heavily-mined-watersheds.html"><a href="identifying-heavily-mined-watersheds.html"><i class="fa fa-check"></i><b>2</b> Identifying heavily mined watersheds</a><ul>
<li class="chapter" data-level="2.1" data-path="identifying-heavily-mined-watersheds.html"><a href="identifying-heavily-mined-watersheds.html#project-outlets-with-same-projection-as-rasters"><i class="fa fa-check"></i><b>2.1</b> Project outlets with same projection as rasters</a><ul>
<li class="chapter" data-level="2.1.1" data-path="identifying-heavily-mined-watersheds.html"><a href="identifying-heavily-mined-watersheds.html#convert-river-network-into-shapefile"><i class="fa fa-check"></i><b>2.1.1</b> Convert river network into shapefile</a></li>
<li class="chapter" data-level="2.1.2" data-path="identifying-heavily-mined-watersheds.html"><a href="identifying-heavily-mined-watersheds.html#reproject-outlets-to-same-projection-as-rasters"><i class="fa fa-check"></i><b>2.1.2</b> Reproject outlets to same projection as rasters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="delineate-watersheds-for-analysis.html"><a href="delineate-watersheds-for-analysis.html"><i class="fa fa-check"></i><b>3</b> Delineate watersheds for analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="delineate-watersheds-for-analysis.html"><a href="delineate-watersheds-for-analysis.html#stack-and-cutup-rasters-to-smaller-extents-for-later-analysis-in-r."><i class="fa fa-check"></i><b>3.1</b> Stack and cutup rasters to smaller extents for later analysis in r.</a></li>
<li class="chapter" data-level="3.2" data-path="delineate-watersheds-for-analysis.html"><a href="delineate-watersheds-for-analysis.html#convert-raster-data-to-data-frames"><i class="fa fa-check"></i><b>3.2</b> Convert raster data to data frames</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="analysis-and-figures.html"><a href="analysis-and-figures.html"><i class="fa fa-check"></i><b>4</b> Analysis and Figures</a><ul>
<li class="chapter" data-level="4.1" data-path="analysis-and-figures.html"><a href="analysis-and-figures.html#a-note-on-proj-4-and-proj-6"><i class="fa fa-check"></i><b>4.1</b> A note on PROJ 4 and PROJ 6</a></li>
<li class="chapter" data-level="4.2" data-path="analysis-and-figures.html"><a href="analysis-and-figures.html#data-prep"><i class="fa fa-check"></i><b>4.2</b> Data Prep</a><ul>
<li class="chapter" data-level="4.2.1" data-path="analysis-and-figures.html"><a href="analysis-and-figures.html#convert-data-to-long-format"><i class="fa fa-check"></i><b>4.2.1</b> Convert data to long format</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="analysis-and-figures.html"><a href="analysis-and-figures.html#figure-1---mining-demonstration"><i class="fa fa-check"></i><b>4.3</b> Figure 1 - Mining demonstration</a></li>
<li class="chapter" data-level="4.4" data-path="analysis-and-figures.html"><a href="analysis-and-figures.html#figure-3-study-map"><i class="fa fa-check"></i><b>4.4</b> Figure 3 Study Map</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="raw-site-summaries.html"><a href="raw-site-summaries.html"><i class="fa fa-check"></i><b>5</b> Raw site summaries</a><ul>
<li class="chapter" data-level="5.1" data-path="raw-site-summaries.html"><a href="raw-site-summaries.html#percent-mining"><i class="fa fa-check"></i><b>5.1</b> Percent mining</a><ul>
<li class="chapter" data-level="5.1.1" data-path="raw-site-summaries.html"><a href="raw-site-summaries.html#elevation"><i class="fa fa-check"></i><b>5.1.1</b> Elevation</a></li>
<li class="chapter" data-level="5.1.2" data-path="raw-site-summaries.html"><a href="raw-site-summaries.html#slope"><i class="fa fa-check"></i><b>5.1.2</b> Slope</a></li>
<li class="chapter" data-level="5.1.3" data-path="raw-site-summaries.html"><a href="raw-site-summaries.html#drainage-density"><i class="fa fa-check"></i><b>5.1.3</b> Drainage density</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="raw-site-summaries.html"><a href="raw-site-summaries.html#total-summary"><i class="fa fa-check"></i><b>5.2</b> Total summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="process-zones-with-slope-area-and-cumulative-area-distribution.html"><a href="process-zones-with-slope-area-and-cumulative-area-distribution.html"><i class="fa fa-check"></i><b>6</b> Process Zones with Slope Area and Cumulative Area Distribution</a><ul>
<li class="chapter" data-level="6.1" data-path="process-zones-with-slope-area-and-cumulative-area-distribution.html"><a href="process-zones-with-slope-area-and-cumulative-area-distribution.html#uaa-slope-cutting"><i class="fa fa-check"></i><b>6.1</b> UAA Slope Cutting</a><ul>
<li class="chapter" data-level="6.1.1" data-path="process-zones-with-slope-area-and-cumulative-area-distribution.html"><a href="process-zones-with-slope-area-and-cumulative-area-distribution.html#slope-area-standard-deviation-plots"><i class="fa fa-check"></i><b>6.1.1</b> Slope Area Standard Deviation Plots</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="process-zones-with-slope-area-and-cumulative-area-distribution.html"><a href="process-zones-with-slope-area-and-cumulative-area-distribution.html#sa-break-id"><i class="fa fa-check"></i><b>6.2</b> SA Break ID</a><ul>
<li class="chapter" data-level="6.2.1" data-path="process-zones-with-slope-area-and-cumulative-area-distribution.html"><a href="process-zones-with-slope-area-and-cumulative-area-distribution.html#region-slopes"><i class="fa fa-check"></i><b>6.2.1</b> Region slopes</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="process-zones-with-slope-area-and-cumulative-area-distribution.html"><a href="process-zones-with-slope-area-and-cumulative-area-distribution.html#figure-4---sa-plots"><i class="fa fa-check"></i><b>6.3</b> Figure 4 - SA Plots</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cumulative-area-distribution.html"><a href="cumulative-area-distribution.html"><i class="fa fa-check"></i><b>7</b> Cumulative area distribution</a><ul>
<li class="chapter" data-level="7.1" data-path="cumulative-area-distribution.html"><a href="cumulative-area-distribution.html#cad-breaks"><i class="fa fa-check"></i><b>7.1</b> Cad breaks</a></li>
<li class="chapter" data-level="7.2" data-path="cumulative-area-distribution.html"><a href="cumulative-area-distribution.html#uaa-density"><i class="fa fa-check"></i><b>7.2</b> UAA Density</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="energy-index.html"><a href="energy-index.html"><i class="fa fa-check"></i><b>8</b> Energy Index</a><ul>
<li class="chapter" data-level="8.1" data-path="energy-index.html"><a href="energy-index.html#figure-6-ei-plots"><i class="fa fa-check"></i><b>8.1</b> Figure 6 EI Plots</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="d-plots.html"><a href="d-plots.html"><i class="fa fa-check"></i><b>9</b> 3D plots</a><ul>
<li class="chapter" data-level="9.1" data-path="d-plots.html"><a href="d-plots.html#terrain-metric-drape"><i class="fa fa-check"></i><b>9.1</b> Terrain metric drape</a></li>
<li class="chapter" data-level="9.2" data-path="d-plots.html"><a href="d-plots.html#draping-zones-over-dem"><i class="fa fa-check"></i><b>9.2</b> Draping zones over DEM</a></li>
<li class="chapter" data-level="9.3" data-path="d-plots.html"><a href="d-plots.html#distribution-of-process-zones-by-site"><i class="fa fa-check"></i><b>9.3</b> Distribution of process zones by site</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="table-of-stats-by-zone.html"><a href="table-of-stats-by-zone.html"><i class="fa fa-check"></i><b>10</b> Table of stats by zone</a></li>
<li class="chapter" data-level="11" data-path="statistical-tests.html"><a href="statistical-tests.html"><i class="fa fa-check"></i><b>11</b> Statistical tests</a></li>
<li class="chapter" data-level="12" data-path="supplemental-informatino.html"><a href="supplemental-informatino.html"><i class="fa fa-check"></i><b>12</b> Supplemental informatino</a></li>
<li class="chapter" data-level="13" data-path="supplement-way-too-much-detail.html"><a href="supplement-way-too-much-detail.html"><i class="fa fa-check"></i><b>13</b> Supplement way too much detail</a><ul>
<li class="chapter" data-level="13.1" data-path="supplement-way-too-much-detail.html"><a href="supplement-way-too-much-detail.html#check-for-differences-between-flow-direction-algorithm-f8-or-f.infinity"><i class="fa fa-check"></i><b>13.1</b> Check for differences between flow direction algorithm (f8 or f.infinity)</a><ul>
<li class="chapter" data-level="13.1.1" data-path="supplement-way-too-much-detail.html"><a href="supplement-way-too-much-detail.html#flow-direction-differnces-in-uplsope-accumulated-area-uaa-for-reference-sites"><i class="fa fa-check"></i><b>13.1.1</b> Flow direction differnces in Uplsope Accumulated Area (UAA) for reference sites</a></li>
<li class="chapter" data-level="13.1.2" data-path="supplement-way-too-much-detail.html"><a href="supplement-way-too-much-detail.html#flow-direction-differences-in-slope"><i class="fa fa-check"></i><b>13.1.2</b> Flow Direction Differences in Slope</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Methods for: Identifying geomorphic process domains in synthetic landscapes of West Virginia, USA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="d-plots" class="section level1">
<h1><span class="header-section-number">9</span> 3D plots</h1>
<div id="terrain-metric-drape" class="section level2">
<h2><span class="header-section-number">9.1</span> Terrain metric drape</h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="d-plots.html#cb32-1"></a>sites &lt;-<span class="st"> </span><span class="kw">names</span>(all.list)</span>
<span id="cb32-2"><a href="d-plots.html#cb32-2"></a></span>
<span id="cb32-3"><a href="d-plots.html#cb32-3"></a>  <span class="co">#Get zlim values</span></span>
<span id="cb32-4"><a href="d-plots.html#cb32-4"></a>lim &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</span>
<span id="cb32-5"><a href="d-plots.html#cb32-5"></a>      max1 &lt;-<span class="st"> </span><span class="kw">maxValue</span>(x)</span>
<span id="cb32-6"><a href="d-plots.html#cb32-6"></a>      min1 &lt;-<span class="st"> </span><span class="kw">minValue</span>(x)</span>
<span id="cb32-7"><a href="d-plots.html#cb32-7"></a>      max2 &lt;-<span class="st"> </span><span class="kw">maxValue</span>(y)</span>
<span id="cb32-8"><a href="d-plots.html#cb32-8"></a>      min2 &lt;-<span class="st"> </span><span class="kw">minValue</span>(y)</span>
<span id="cb32-9"><a href="d-plots.html#cb32-9"></a>      zlims &lt;-<span class="kw">c</span>(<span class="kw">floor</span>(<span class="kw">min</span>(<span class="kw">c</span>(min1,min2))),<span class="kw">ceiling</span>(<span class="kw">max</span>(<span class="kw">c</span>(max1,max2))))</span>
<span id="cb32-10"><a href="d-plots.html#cb32-10"></a>      <span class="kw">return</span>(zlims)</span>
<span id="cb32-11"><a href="d-plots.html#cb32-11"></a>  }</span>
<span id="cb32-12"><a href="d-plots.html#cb32-12"></a></span>
<span id="cb32-13"><a href="d-plots.html#cb32-13"></a>super_plotter &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">spruce =</span> all.list[[<span class="dv">10</span>]],</span>
<span id="cb32-14"><a href="d-plots.html#cb32-14"></a>                          <span class="dt">filename =</span> filename){</span>
<span id="cb32-15"><a href="d-plots.html#cb32-15"></a>  newdem &lt;-<span class="st"> </span>spruce[[<span class="dv">1</span>]]</span>
<span id="cb32-16"><a href="d-plots.html#cb32-16"></a>  olddem &lt;-<span class="st"> </span>spruce[[<span class="dv">4</span>]]</span>
<span id="cb32-17"><a href="d-plots.html#cb32-17"></a>  newfac &lt;-<span class="st"> </span>spruce[[<span class="dv">9</span>]]</span>
<span id="cb32-18"><a href="d-plots.html#cb32-18"></a>  oldfac &lt;-<span class="st"> </span>spruce[[<span class="dv">10</span>]]</span>
<span id="cb32-19"><a href="d-plots.html#cb32-19"></a>  newslp &lt;-<span class="st"> </span>spruce[[<span class="dv">5</span>]]</span>
<span id="cb32-20"><a href="d-plots.html#cb32-20"></a>  oldslp &lt;-<span class="st"> </span>spruce[[<span class="dv">6</span>]]</span>
<span id="cb32-21"><a href="d-plots.html#cb32-21"></a>  newei &lt;-<span class="st"> </span>newfac<span class="op">*</span>newslp</span>
<span id="cb32-22"><a href="d-plots.html#cb32-22"></a>  oldei &lt;-<span class="st"> </span>oldfac<span class="op">*</span>oldslp</span>
<span id="cb32-23"><a href="d-plots.html#cb32-23"></a>  </span>
<span id="cb32-24"><a href="d-plots.html#cb32-24"></a>  </span>
<span id="cb32-25"><a href="d-plots.html#cb32-25"></a>  <span class="co">#Convert rasters to matrices</span></span>
<span id="cb32-26"><a href="d-plots.html#cb32-26"></a>  old.s &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(oldslp)</span>
<span id="cb32-27"><a href="d-plots.html#cb32-27"></a>  new.s &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(newslp)</span>
<span id="cb32-28"><a href="d-plots.html#cb32-28"></a>  old.ei &lt;-<span class="st"> </span><span class="kw">log10</span>(<span class="kw">as.matrix</span>(oldei))</span>
<span id="cb32-29"><a href="d-plots.html#cb32-29"></a>  new.ei &lt;-<span class="st"> </span><span class="kw">log10</span>(<span class="kw">as.matrix</span>(newei))</span>
<span id="cb32-30"><a href="d-plots.html#cb32-30"></a>  old.ei[old.ei<span class="op">==-</span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb32-31"><a href="d-plots.html#cb32-31"></a>  new.ei[new.ei<span class="op">==-</span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb32-32"><a href="d-plots.html#cb32-32"></a>  </span>
<span id="cb32-33"><a href="d-plots.html#cb32-33"></a>  </span>
<span id="cb32-34"><a href="d-plots.html#cb32-34"></a>  old.m.na &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(olddem)</span>
<span id="cb32-35"><a href="d-plots.html#cb32-35"></a>  new.m.na &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(newdem)</span>
<span id="cb32-36"><a href="d-plots.html#cb32-36"></a>  olddem[<span class="kw">is.na</span>(olddem)] &lt;-<span class="st"> </span><span class="kw">minValue</span>(olddem)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb32-37"><a href="d-plots.html#cb32-37"></a>  newdem[<span class="kw">is.na</span>(newdem)] &lt;-<span class="st"> </span><span class="kw">minValue</span>(newdem)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb32-38"><a href="d-plots.html#cb32-38"></a>  old.m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(olddem)</span>
<span id="cb32-39"><a href="d-plots.html#cb32-39"></a>  new.m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(newdem)</span>
<span id="cb32-40"><a href="d-plots.html#cb32-40"></a>  old.f.m &lt;-<span class="st"> </span><span class="kw">log10</span>(<span class="kw">as.matrix</span>(oldfac))</span>
<span id="cb32-41"><a href="d-plots.html#cb32-41"></a>  old.f.m[old.f.m<span class="op">==-</span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb32-42"><a href="d-plots.html#cb32-42"></a>  new.f.m &lt;-<span class="st"> </span><span class="kw">log10</span>(<span class="kw">as.matrix</span>(newfac))</span>
<span id="cb32-43"><a href="d-plots.html#cb32-43"></a>  new.f.m[new.f.m<span class="op">==-</span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb32-44"><a href="d-plots.html#cb32-44"></a>  x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(old.m)<span class="op">*</span><span class="dv">10</span></span>
<span id="cb32-45"><a href="d-plots.html#cb32-45"></a>  y &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(old.m)<span class="op">*</span><span class="dv">10</span></span>
<span id="cb32-46"><a href="d-plots.html#cb32-46"></a>  </span>
<span id="cb32-47"><a href="d-plots.html#cb32-47"></a></span>
<span id="cb32-48"><a href="d-plots.html#cb32-48"></a></span>
<span id="cb32-49"><a href="d-plots.html#cb32-49"></a>  <span class="kw">png</span>(<span class="dt">filename=</span>filename,<span class="dt">width=</span><span class="dv">12</span>,<span class="dt">height=</span><span class="dv">10</span>,<span class="dt">units=</span><span class="st">&#39;in&#39;</span>,<span class="dt">res=</span><span class="dv">300</span>)</span>
<span id="cb32-50"><a href="d-plots.html#cb32-50"></a>    <span class="co">#Verbose code to get exactly the plot I want. </span></span>
<span id="cb32-51"><a href="d-plots.html#cb32-51"></a>    cols &lt;-<span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;forestgreen&#39;</span>,<span class="st">&#39;brown2&#39;</span>))</span>
<span id="cb32-52"><a href="d-plots.html#cb32-52"></a>    bord &lt;-<span class="st"> </span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb32-53"><a href="d-plots.html#cb32-53"></a>    </span>
<span id="cb32-54"><a href="d-plots.html#cb32-54"></a>    </span>
<span id="cb32-55"><a href="d-plots.html#cb32-55"></a>    </span>
<span id="cb32-56"><a href="d-plots.html#cb32-56"></a>    <span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>),<span class="dt">mgp=</span><span class="kw">c</span>(<span class="fl">1.8</span>,<span class="fl">0.5</span>,<span class="dv">0</span>),<span class="dt">cex=</span><span class="fl">1.5</span>,<span class="dt">cex.lab=</span><span class="fl">1.5</span>,<span class="dt">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb32-57"><a href="d-plots.html#cb32-57"></a>    </span>
<span id="cb32-58"><a href="d-plots.html#cb32-58"></a>    mx &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">11</span>,<span class="dv">12</span>),<span class="dv">4</span>,<span class="dv">5</span>,<span class="dt">byrow=</span>T)</span>
<span id="cb32-59"><a href="d-plots.html#cb32-59"></a>    <span class="kw">layout</span>(mx)</span>
<span id="cb32-60"><a href="d-plots.html#cb32-60"></a>    </span>
<span id="cb32-61"><a href="d-plots.html#cb32-61"></a>    <span class="co">#OldDEM</span></span>
<span id="cb32-62"><a href="d-plots.html#cb32-62"></a>    l.dist &lt;-<span class="st"> </span><span class="fl">-0.05</span></span>
<span id="cb32-63"><a href="d-plots.html#cb32-63"></a>    theta &lt;-<span class="st"> </span><span class="fl">-90.5</span></span>
<span id="cb32-64"><a href="d-plots.html#cb32-64"></a>    phi &lt;-<span class="st"> </span><span class="dv">45</span></span>
<span id="cb32-65"><a href="d-plots.html#cb32-65"></a>    shade=.<span class="dv">65</span></span>
<span id="cb32-66"><a href="d-plots.html#cb32-66"></a>    lphi=<span class="dv">0</span></span>
<span id="cb32-67"><a href="d-plots.html#cb32-67"></a>    ltheta=<span class="op">-</span><span class="dv">135</span></span>
<span id="cb32-68"><a href="d-plots.html#cb32-68"></a>    <span class="co"># par(mfrow=c(1,2))</span></span>
<span id="cb32-69"><a href="d-plots.html#cb32-69"></a>    <span class="co"># hist(old.f.m,col=&#39;grey&#39;,ylim=c(0,6000),breaks=seq(0,7,by=.1))</span></span>
<span id="cb32-70"><a href="d-plots.html#cb32-70"></a>    <span class="co"># hist(new.f.m,col=&#39;grey&#39;,ylim=c(0,6000),breaks=seq(0,7,by=.1))</span></span>
<span id="cb32-71"><a href="d-plots.html#cb32-71"></a>    <span class="co"># </span></span>
<span id="cb32-72"><a href="d-plots.html#cb32-72"></a>    zlims &lt;-<span class="st"> </span><span class="kw">lim</span>(olddem,newdem)</span>
<span id="cb32-73"><a href="d-plots.html#cb32-73"></a>    </span>
<span id="cb32-74"><a href="d-plots.html#cb32-74"></a>    </span>
<span id="cb32-75"><a href="d-plots.html#cb32-75"></a>    <span class="co">## Old DEM, Top Left</span></span>
<span id="cb32-76"><a href="d-plots.html#cb32-76"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb32-77"><a href="d-plots.html#cb32-77"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elev. (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-78"><a href="d-plots.html#cb32-78"></a>            <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb32-79"><a href="d-plots.html#cb32-79"></a>    </span>
<span id="cb32-80"><a href="d-plots.html#cb32-80"></a>  </span>
<span id="cb32-81"><a href="d-plots.html#cb32-81"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m.na,<span class="dt">col=</span><span class="kw">c</span>(bord,<span class="kw">cols</span>(<span class="dv">200</span>)),</span>
<span id="cb32-82"><a href="d-plots.html#cb32-82"></a>            <span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">side=</span><span class="dv">4</span>,<span class="dt">line.clab=</span><span class="dv">1</span>,<span class="dt">dist=</span>l.dist,<span class="dt">width=</span><span class="fl">0.75</span>,<span class="dt">length=</span><span class="fl">0.5</span>,<span class="dt">mgp=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="fl">0.6</span>,<span class="dv">0</span>)),</span>
<span id="cb32-83"><a href="d-plots.html#cb32-83"></a>            <span class="dt">lighting=</span>T,<span class="dt">add=</span>T,<span class="dt">clim=</span>zlims,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-84"><a href="d-plots.html#cb32-84"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="fl">0.6</span>,<span class="dt">clab=</span><span class="st">&#39;Elev. (m)&#39;</span>,<span class="dt">expand=</span><span class="dv">2</span>,</span>
<span id="cb32-85"><a href="d-plots.html#cb32-85"></a>            <span class="dt">inttype=</span><span class="dv">2</span>)</span>
<span id="cb32-86"><a href="d-plots.html#cb32-86"></a>    </span>
<span id="cb32-87"><a href="d-plots.html#cb32-87"></a>    </span>
<span id="cb32-88"><a href="d-plots.html#cb32-88"></a>    <span class="co">#NewDEM, Top Middle</span></span>
<span id="cb32-89"><a href="d-plots.html#cb32-89"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb32-90"><a href="d-plots.html#cb32-90"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elev. (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-91"><a href="d-plots.html#cb32-91"></a>            <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb32-92"><a href="d-plots.html#cb32-92"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m.na,<span class="dt">col=</span><span class="kw">c</span>(bord,<span class="kw">cols</span>(<span class="dv">200</span>)),<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span>F),</span>
<span id="cb32-93"><a href="d-plots.html#cb32-93"></a>            <span class="dt">lighting=</span>T,<span class="dt">add=</span>T,<span class="dt">clim=</span>zlims,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-94"><a href="d-plots.html#cb32-94"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="fl">0.6</span>,<span class="dt">clab=</span><span class="st">&#39;Elev. (m)&#39;</span>,<span class="dt">expand=</span><span class="dv">2</span>,</span>
<span id="cb32-95"><a href="d-plots.html#cb32-95"></a>            <span class="dt">inttype=</span><span class="dv">2</span>)</span>
<span id="cb32-96"><a href="d-plots.html#cb32-96"></a>    </span>
<span id="cb32-97"><a href="d-plots.html#cb32-97"></a>    area =<span class="st"> </span><span class="kw">round</span>(<span class="kw">length</span>(new.m.na)<span class="op">/</span>(<span class="dv">10000</span>),<span class="dv">0</span>)</span>
<span id="cb32-98"><a href="d-plots.html#cb32-98"></a>    </span>
<span id="cb32-99"><a href="d-plots.html#cb32-99"></a>    label =<span class="st"> </span><span class="kw">bquote</span>(.(sites[i]) <span class="op">~</span><span class="st"> &#39;-&#39;</span> <span class="op">~</span><span class="st"> </span>.({area}) <span class="op">~</span><span class="st"> </span>km<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb32-100"><a href="d-plots.html#cb32-100"></a>    </span>
<span id="cb32-101"><a href="d-plots.html#cb32-101"></a>    <span class="kw">mtext</span>(label, <span class="dt">side =</span> <span class="dv">3</span>, <span class="dt">line =</span> <span class="fl">-1.5</span>,</span>
<span id="cb32-102"><a href="d-plots.html#cb32-102"></a>          <span class="dt">cex =</span> <span class="dv">2</span>)</span>
<span id="cb32-103"><a href="d-plots.html#cb32-103"></a>    </span>
<span id="cb32-104"><a href="d-plots.html#cb32-104"></a>    <span class="co">#Elevation histogram, top right</span></span>
<span id="cb32-105"><a href="d-plots.html#cb32-105"></a>    hist.mar &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="dv">2</span>)</span>
<span id="cb32-106"><a href="d-plots.html#cb32-106"></a>    <span class="kw">par</span>(<span class="dt">mar=</span>hist.mar)</span>
<span id="cb32-107"><a href="d-plots.html#cb32-107"></a>    <span class="kw">hist</span>(old.m.na,<span class="dt">breaks=</span><span class="kw">seq</span>(zlims[<span class="dv">1</span>],zlims[<span class="dv">2</span>],<span class="dt">length.out=</span><span class="dv">50</span>),<span class="dt">xlim=</span>zlims,<span class="dt">col=</span><span class="st">&#39;blue&#39;</span>,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">7000</span>),<span class="dt">xlab=</span><span class="st">&#39;Elevation (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;Frequency&#39;</span>,<span class="dt">main=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb32-108"><a href="d-plots.html#cb32-108"></a>    reds2 &lt;-<span class="st"> </span><span class="kw">makeTransparent</span>(<span class="st">&#39;red&#39;</span>,<span class="dt">alpha=</span>.<span class="dv">8</span>)</span>
<span id="cb32-109"><a href="d-plots.html#cb32-109"></a>    <span class="kw">hist</span>(new.m.na, <span class="dt">breaks=</span><span class="kw">seq</span>(zlims[<span class="dv">1</span>],zlims[<span class="dv">2</span>],<span class="dt">length.out=</span><span class="dv">50</span>),<span class="dt">xlim=</span>zlims,<span class="dt">col=</span>reds2,<span class="dt">add=</span>T,<span class="dt">density=</span><span class="dv">40</span>)</span>
<span id="cb32-110"><a href="d-plots.html#cb32-110"></a>    <span class="kw">text</span>(<span class="dt">x =</span> zlims[<span class="dv">1</span>]<span class="op">*</span><span class="fl">1.1</span>, <span class="dt">y =</span> <span class="dv">6000</span>,</span>
<span id="cb32-111"><a href="d-plots.html#cb32-111"></a>         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>),</span>
<span id="cb32-112"><a href="d-plots.html#cb32-112"></a>         <span class="dt">cex =</span> <span class="dv">3</span>)</span>
<span id="cb32-113"><a href="d-plots.html#cb32-113"></a>    </span>
<span id="cb32-114"><a href="d-plots.html#cb32-114"></a>    </span>
<span id="cb32-115"><a href="d-plots.html#cb32-115"></a>    </span>
<span id="cb32-116"><a href="d-plots.html#cb32-116"></a>    <span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb32-117"><a href="d-plots.html#cb32-117"></a>    <span class="co">#OldSlope</span></span>
<span id="cb32-118"><a href="d-plots.html#cb32-118"></a>    </span>
<span id="cb32-119"><a href="d-plots.html#cb32-119"></a>    slims &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb32-120"><a href="d-plots.html#cb32-120"></a>    scols &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;yellow3&#39;</span>,<span class="st">&#39;red&#39;</span>,<span class="st">&#39;red4&#39;</span>))</span>
<span id="cb32-121"><a href="d-plots.html#cb32-121"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb32-122"><a href="d-plots.html#cb32-122"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elevation (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-123"><a href="d-plots.html#cb32-123"></a>            <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb32-124"><a href="d-plots.html#cb32-124"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m.na,<span class="dt">col=</span><span class="kw">c</span>(<span class="kw">scols</span>(<span class="dv">200</span>)),<span class="dt">colvar =</span> old.s,</span>
<span id="cb32-125"><a href="d-plots.html#cb32-125"></a>            <span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">side=</span><span class="dv">4</span>,<span class="dt">line.clab=</span><span class="dv">1</span>,<span class="dt">dist=</span>l.dist,<span class="dt">width=</span><span class="fl">0.75</span>,<span class="dt">length=</span><span class="fl">0.5</span>,<span class="dt">mgp=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="fl">0.6</span>,<span class="dv">0</span>)),</span>
<span id="cb32-126"><a href="d-plots.html#cb32-126"></a>            <span class="dt">add=</span>T,<span class="dt">clim=</span>slims,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,<span class="dt">NAcol=</span>bord,</span>
<span id="cb32-127"><a href="d-plots.html#cb32-127"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>,<span class="dt">clab=</span><span class="st">&#39;Slope (m/m)&#39;</span>,<span class="dt">expand=</span><span class="dv">2</span>,<span class="dt">shade=</span>shade,<span class="dt">lphi=</span>lphi,<span class="dt">ltheta=</span>ltheta,</span>
<span id="cb32-128"><a href="d-plots.html#cb32-128"></a>            <span class="dt">inttype=</span><span class="dv">2</span>)</span>
<span id="cb32-129"><a href="d-plots.html#cb32-129"></a>    </span>
<span id="cb32-130"><a href="d-plots.html#cb32-130"></a>    <span class="co">#NewSlope</span></span>
<span id="cb32-131"><a href="d-plots.html#cb32-131"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb32-132"><a href="d-plots.html#cb32-132"></a>                <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elevation (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-133"><a href="d-plots.html#cb32-133"></a>                <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb32-134"><a href="d-plots.html#cb32-134"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m.na,<span class="dt">col=</span><span class="kw">c</span>(<span class="kw">scols</span>(<span class="dv">200</span>)),<span class="dt">colvar=</span>new.s,<span class="dt">NAcol=</span>bord,</span>
<span id="cb32-135"><a href="d-plots.html#cb32-135"></a>            <span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span>F),<span class="dt">add=</span>T,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,<span class="dt">shade=</span>shade,<span class="dt">lphi=</span>lphi,<span class="dt">ltheta=</span>ltheta,</span>
<span id="cb32-136"><a href="d-plots.html#cb32-136"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>,<span class="dt">clab=</span><span class="st">&#39;Slope (m/m)&#39;</span>,<span class="dt">expand=</span><span class="dv">2</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">clims=</span>slims)</span>
<span id="cb32-137"><a href="d-plots.html#cb32-137"></a>    </span>
<span id="cb32-138"><a href="d-plots.html#cb32-138"></a>    </span>
<span id="cb32-139"><a href="d-plots.html#cb32-139"></a>    <span class="kw">par</span>(<span class="dt">mar=</span>hist.mar)</span>
<span id="cb32-140"><a href="d-plots.html#cb32-140"></a>    </span>
<span id="cb32-141"><a href="d-plots.html#cb32-141"></a>    <span class="cf">if</span>(sites[i] <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;WhiteOak&#39;</span>, <span class="st">&#39;Laurel&#39;</span>,<span class="st">&#39;Ben&#39;</span>)){</span>
<span id="cb32-142"><a href="d-plots.html#cb32-142"></a>    <span class="kw">hist</span>(old.s,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">4</span>,<span class="dt">length.out=</span><span class="dv">150</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.2</span>),<span class="dt">col=</span><span class="st">&#39;blue&#39;</span>,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10000</span>),<span class="dt">xlab=</span><span class="st">&#39;Slope (m/m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;Frequency&#39;</span>,<span class="dt">main=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb32-143"><a href="d-plots.html#cb32-143"></a>    <span class="kw">hist</span>(new.s, <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">4</span>,<span class="dt">length.out=</span><span class="dv">150</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.2</span>),<span class="dt">col=</span>reds2,<span class="dt">add=</span>T,<span class="dt">density=</span><span class="dv">40</span>)</span>
<span id="cb32-144"><a href="d-plots.html#cb32-144"></a>        <span class="kw">text</span>(<span class="dt">x =</span> <span class="fl">0.1</span>, <span class="dt">y =</span> <span class="dv">9000</span>,</span>
<span id="cb32-145"><a href="d-plots.html#cb32-145"></a>         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;B&#39;</span>),</span>
<span id="cb32-146"><a href="d-plots.html#cb32-146"></a>         <span class="dt">cex =</span> <span class="dv">4</span>)</span>
<span id="cb32-147"><a href="d-plots.html#cb32-147"></a>    }<span class="cf">else</span>{</span>
<span id="cb32-148"><a href="d-plots.html#cb32-148"></a>         <span class="kw">hist</span>(old.s,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">4</span>,<span class="dt">length.out=</span><span class="dv">100</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.2</span>),<span class="dt">col=</span><span class="st">&#39;blue&#39;</span>,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">8000</span>),<span class="dt">xlab=</span><span class="st">&#39;Slope (m/m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;Frequency&#39;</span>,<span class="dt">main=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb32-149"><a href="d-plots.html#cb32-149"></a>    <span class="kw">hist</span>(new.s, <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">4</span>,<span class="dt">length.out=</span><span class="dv">100</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.2</span>),<span class="dt">col=</span>reds2,<span class="dt">add=</span>T,<span class="dt">density=</span><span class="dv">40</span>)</span>
<span id="cb32-150"><a href="d-plots.html#cb32-150"></a>        <span class="kw">text</span>(<span class="dt">x =</span> <span class="fl">0.1</span>, <span class="dt">y =</span> <span class="dv">7000</span>,</span>
<span id="cb32-151"><a href="d-plots.html#cb32-151"></a>         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;B&#39;</span>),</span>
<span id="cb32-152"><a href="d-plots.html#cb32-152"></a>         <span class="dt">cex =</span> <span class="dv">3</span>)</span>
<span id="cb32-153"><a href="d-plots.html#cb32-153"></a>    }</span>
<span id="cb32-154"><a href="d-plots.html#cb32-154"></a></span>
<span id="cb32-155"><a href="d-plots.html#cb32-155"></a>    </span>
<span id="cb32-156"><a href="d-plots.html#cb32-156"></a></span>
<span id="cb32-157"><a href="d-plots.html#cb32-157"></a>    <span class="co">#OldFAC</span></span>
<span id="cb32-158"><a href="d-plots.html#cb32-158"></a>    <span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb32-159"><a href="d-plots.html#cb32-159"></a>    flims &lt;-<span class="st"> </span><span class="kw">log10</span>(<span class="kw">lim</span>(newfac,oldfac))</span>
<span id="cb32-160"><a href="d-plots.html#cb32-160"></a>    cols.f &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;lightblue&#39;</span>,<span class="st">&#39;darkblue&#39;</span>,<span class="st">&#39;purple4&#39;</span>,<span class="st">&#39;mediumvioletred&#39;</span>))</span>
<span id="cb32-161"><a href="d-plots.html#cb32-161"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb32-162"><a href="d-plots.html#cb32-162"></a>                <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elevation (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-163"><a href="d-plots.html#cb32-163"></a>                <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb32-164"><a href="d-plots.html#cb32-164"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m.na,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;white&#39;</span>,<span class="kw">cols.f</span>(<span class="dv">50</span>)),<span class="dt">colvar=</span>(old.f.m),</span>
<span id="cb32-165"><a href="d-plots.html#cb32-165"></a>            <span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">side=</span><span class="dv">4</span>,<span class="dt">line.clab=</span><span class="dv">1</span>,<span class="dt">dist=</span>l.dist,<span class="dt">width=</span><span class="fl">0.75</span>,<span class="dt">length=</span><span class="fl">0.5</span>,<span class="dt">mgp=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="fl">0.6</span>,<span class="dv">0</span>)),</span>
<span id="cb32-166"><a href="d-plots.html#cb32-166"></a>            <span class="dt">add=</span>T,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,<span class="dt">shade=</span>shade,<span class="dt">lphi=</span>lphi,<span class="dt">ltheta=</span>ltheta,</span>
<span id="cb32-167"><a href="d-plots.html#cb32-167"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>,<span class="dt">clab=</span><span class="kw">expression</span>(<span class="kw">bold</span>(<span class="kw">paste</span>(<span class="st">&#39;Log UAA (&#39;</span>,m<span class="op">^</span><span class="dv">2</span>,<span class="st">&#39;)&#39;</span>,<span class="dt">sep=</span><span class="st">&#39;&#39;</span>))),<span class="dt">expand=</span><span class="dv">2</span>,<span class="dt">clims=</span>flims,</span>
<span id="cb32-168"><a href="d-plots.html#cb32-168"></a>            <span class="dt">inttype=</span><span class="dv">2</span>)</span>
<span id="cb32-169"><a href="d-plots.html#cb32-169"></a>    </span>
<span id="cb32-170"><a href="d-plots.html#cb32-170"></a>    </span>
<span id="cb32-171"><a href="d-plots.html#cb32-171"></a>    </span>
<span id="cb32-172"><a href="d-plots.html#cb32-172"></a>    <span class="co">#NewFAC</span></span>
<span id="cb32-173"><a href="d-plots.html#cb32-173"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb32-174"><a href="d-plots.html#cb32-174"></a>                <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elevation (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-175"><a href="d-plots.html#cb32-175"></a>                <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb32-176"><a href="d-plots.html#cb32-176"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m.na,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;white&#39;</span>,<span class="kw">cols.f</span>(<span class="dv">100</span>)),<span class="dt">colvar=</span>new.f.m,</span>
<span id="cb32-177"><a href="d-plots.html#cb32-177"></a>            <span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span>F),<span class="dt">add=</span>T,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-178"><a href="d-plots.html#cb32-178"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>,<span class="dt">clab=</span><span class="st">&#39;&#39;</span>,<span class="dt">shade=</span>shade,<span class="dt">lphi=</span>lphi,<span class="dt">ltheta=</span>ltheta,</span>
<span id="cb32-179"><a href="d-plots.html#cb32-179"></a>            <span class="dt">expand=</span><span class="dv">2</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">clims=</span>flims)</span>
<span id="cb32-180"><a href="d-plots.html#cb32-180"></a>    </span>
<span id="cb32-181"><a href="d-plots.html#cb32-181"></a>    old.f &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span>old.f.m</span>
<span id="cb32-182"><a href="d-plots.html#cb32-182"></a>    </span>
<span id="cb32-183"><a href="d-plots.html#cb32-183"></a>    <span class="kw">par</span>(<span class="dt">mar=</span>hist.mar)</span>
<span id="cb32-184"><a href="d-plots.html#cb32-184"></a>    <span class="kw">hist</span>(old.f.m,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="fl">6.05</span>,<span class="dt">length.out=</span><span class="dv">100</span>),<span class="dt">col=</span><span class="st">&#39;blue&#39;</span>,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">8000</span>),</span>
<span id="cb32-185"><a href="d-plots.html#cb32-185"></a>      <span class="dt">xlab=</span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;UAA (&#39;</span>,m<span class="op">^</span><span class="dv">2</span>,<span class="st">&#39;)&#39;</span>,<span class="dt">sep=</span><span class="st">&#39;&#39;</span>)),<span class="dt">ylab=</span><span class="st">&#39;Frequency&#39;</span>,<span class="dt">main=</span><span class="st">&#39;&#39;</span>,<span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb32-186"><a href="d-plots.html#cb32-186"></a>    <span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>),<span class="dt">labels=</span><span class="kw">c</span>(<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">1</span>),<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">2</span>),<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">3</span>),<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">4</span>),<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">5</span>),<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">6</span>)))</span>
<span id="cb32-187"><a href="d-plots.html#cb32-187"></a>    <span class="kw">hist</span>(new.f.m, <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="fl">6.05</span>,<span class="dt">length.out=</span><span class="dv">100</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">6</span>),<span class="dt">col=</span>reds2,<span class="dt">add=</span>T,<span class="dt">density=</span><span class="dv">40</span>)</span>
<span id="cb32-188"><a href="d-plots.html#cb32-188"></a>    <span class="kw">legend</span>(<span class="dt">x=</span><span class="dv">3</span>,<span class="dt">y=</span><span class="dv">4000</span>,<span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">15</span>,<span class="dv">15</span>),<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;blue&#39;</span>,reds2),<span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&#39;Pre-Mining&#39;</span>,<span class="st">&#39;Post-Mining&#39;</span>),<span class="dt">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb32-189"><a href="d-plots.html#cb32-189"></a>    <span class="kw">text</span>(<span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">7000</span>,</span>
<span id="cb32-190"><a href="d-plots.html#cb32-190"></a>         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;C&#39;</span>),</span>
<span id="cb32-191"><a href="d-plots.html#cb32-191"></a>         <span class="dt">cex =</span> <span class="dv">3</span>)</span>
<span id="cb32-192"><a href="d-plots.html#cb32-192"></a>    </span>
<span id="cb32-193"><a href="d-plots.html#cb32-193"></a>    </span>
<span id="cb32-194"><a href="d-plots.html#cb32-194"></a>    <span class="co">#OldEI</span></span>
<span id="cb32-195"><a href="d-plots.html#cb32-195"></a>    <span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb32-196"><a href="d-plots.html#cb32-196"></a>    ei.lims &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">5</span>)</span>
<span id="cb32-197"><a href="d-plots.html#cb32-197"></a>    ei.cols &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;tan2&#39;</span>,<span class="st">&#39;tan4&#39;</span>,<span class="st">&#39;cyan&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;green&#39;</span>,<span class="st">&#39;green&#39;</span>))</span>
<span id="cb32-198"><a href="d-plots.html#cb32-198"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb32-199"><a href="d-plots.html#cb32-199"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elevation (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-200"><a href="d-plots.html#cb32-200"></a>            <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb32-201"><a href="d-plots.html#cb32-201"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m.na,<span class="dt">col=</span><span class="kw">c</span>(<span class="kw">ei.cols</span>(<span class="dv">200</span>)),<span class="dt">colvar =</span> old.ei,<span class="dt">NAcols=</span>bord,</span>
<span id="cb32-202"><a href="d-plots.html#cb32-202"></a>            <span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">side=</span><span class="dv">4</span>,<span class="dt">line.clab=</span><span class="dv">1</span>,<span class="dt">dist=</span>l.dist,<span class="dt">width=</span><span class="fl">0.75</span>,<span class="dt">length=</span><span class="fl">0.5</span>,<span class="dt">mgp=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="fl">0.6</span>,<span class="dv">0</span>)),</span>
<span id="cb32-203"><a href="d-plots.html#cb32-203"></a>            <span class="dt">add=</span>T,<span class="dt">clim=</span>ei.lims,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,<span class="dt">NAcol=</span>bord,<span class="dt">shade=</span>shade,<span class="dt">lphi=</span>lphi,<span class="dt">ltheta=</span>ltheta,</span>
<span id="cb32-204"><a href="d-plots.html#cb32-204"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>,<span class="dt">clab=</span><span class="st">&#39;Log EI&#39;</span>,<span class="dt">expand=</span><span class="dv">2</span>,</span>
<span id="cb32-205"><a href="d-plots.html#cb32-205"></a>            <span class="dt">inttype=</span><span class="dv">2</span>)</span>
<span id="cb32-206"><a href="d-plots.html#cb32-206"></a>    </span>
<span id="cb32-207"><a href="d-plots.html#cb32-207"></a>    </span>
<span id="cb32-208"><a href="d-plots.html#cb32-208"></a>    <span class="co">#NewEI</span></span>
<span id="cb32-209"><a href="d-plots.html#cb32-209"></a>    <span class="co">#Shorten the color ramp </span></span>
<span id="cb32-210"><a href="d-plots.html#cb32-210"></a>    new.ei[new.ei <span class="op">&lt;</span><span class="st"> </span><span class="dv">-2</span>] &lt;-<span class="st"> </span><span class="dv">-2</span></span>
<span id="cb32-211"><a href="d-plots.html#cb32-211"></a>    </span>
<span id="cb32-212"><a href="d-plots.html#cb32-212"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb32-213"><a href="d-plots.html#cb32-213"></a>                <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elevation (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb32-214"><a href="d-plots.html#cb32-214"></a>                <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb32-215"><a href="d-plots.html#cb32-215"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m.na,<span class="dt">col=</span><span class="kw">c</span>(<span class="kw">ei.cols</span>(<span class="dv">200</span>)),<span class="dt">colvar=</span>new.ei,<span class="dt">NAcol=</span>bord,</span>
<span id="cb32-216"><a href="d-plots.html#cb32-216"></a>            <span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span>F),<span class="dt">add=</span>T,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,<span class="dt">shade=</span>shade,<span class="dt">lphi=</span>lphi,<span class="dt">ltheta=</span>ltheta,</span>
<span id="cb32-217"><a href="d-plots.html#cb32-217"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>,<span class="dt">clab=</span><span class="st">&#39;Slope (m/m)&#39;</span>,<span class="dt">expand=</span><span class="dv">2</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">clims=</span>ei.lims)</span>
<span id="cb32-218"><a href="d-plots.html#cb32-218"></a>    </span>
<span id="cb32-219"><a href="d-plots.html#cb32-219"></a>    </span>
<span id="cb32-220"><a href="d-plots.html#cb32-220"></a>    </span>
<span id="cb32-221"><a href="d-plots.html#cb32-221"></a>    <span class="kw">par</span>(<span class="dt">mar=</span>hist.mar)</span>
<span id="cb32-222"><a href="d-plots.html#cb32-222"></a>    <span class="kw">hist</span>(old.ei,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">2.1</span>,<span class="dv">6</span>,<span class="dt">length.out=</span><span class="dv">100</span>),<span class="dt">col=</span><span class="st">&#39;blue&#39;</span>,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">8000</span>),</span>
<span id="cb32-223"><a href="d-plots.html#cb32-223"></a>      <span class="dt">xlab=</span><span class="st">&#39;Energy Index&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;Frequency&#39;</span>,<span class="dt">main=</span><span class="st">&#39;&#39;</span>,<span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb32-224"><a href="d-plots.html#cb32-224"></a>    <span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>),<span class="dt">labels=</span><span class="kw">c</span>(<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">1</span>),<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">1</span>),<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">3</span>),<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">5</span>),<span class="kw">expression</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">7</span>)))</span>
<span id="cb32-225"><a href="d-plots.html#cb32-225"></a>    <span class="kw">hist</span>(new.ei, <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">2.1</span>,<span class="dv">6</span>,<span class="dt">length.out=</span><span class="dv">100</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">7.1</span>),<span class="dt">col=</span>reds2,<span class="dt">add=</span>T,<span class="dt">density=</span><span class="dv">40</span>)</span>
<span id="cb32-226"><a href="d-plots.html#cb32-226"></a>    <span class="kw">text</span>(<span class="dt">x =</span> <span class="fl">0.01</span>, <span class="dt">y =</span> <span class="dv">7000</span>,</span>
<span id="cb32-227"><a href="d-plots.html#cb32-227"></a>         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;D&#39;</span>),</span>
<span id="cb32-228"><a href="d-plots.html#cb32-228"></a>         <span class="dt">cex =</span> <span class="dv">3</span>)</span>
<span id="cb32-229"><a href="d-plots.html#cb32-229"></a>  </span>
<span id="cb32-230"><a href="d-plots.html#cb32-230"></a>  <span class="kw">dev.off</span>()</span>
<span id="cb32-231"><a href="d-plots.html#cb32-231"></a>  </span>
<span id="cb32-232"><a href="d-plots.html#cb32-232"></a>}</span>
<span id="cb32-233"><a href="d-plots.html#cb32-233"></a></span>
<span id="cb32-234"><a href="d-plots.html#cb32-234"></a></span>
<span id="cb32-235"><a href="d-plots.html#cb32-235"></a></span>
<span id="cb32-236"><a href="d-plots.html#cb32-236"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(sites)){</span>
<span id="cb32-237"><a href="d-plots.html#cb32-237"></a>  <span class="kw">print</span>(sites[i])</span>
<span id="cb32-238"><a href="d-plots.html#cb32-238"></a>  filename =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;Figures2018/3d_indices/&#39;</span>,sites[i],<span class="st">&#39;_3D_4_indices.png&#39;</span>)</span>
<span id="cb32-239"><a href="d-plots.html#cb32-239"></a>  </span>
<span id="cb32-240"><a href="d-plots.html#cb32-240"></a>  <span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(filename)){</span>
<span id="cb32-241"><a href="d-plots.html#cb32-241"></a>  <span class="kw">super_plotter</span>(all.list[[i]],</span>
<span id="cb32-242"><a href="d-plots.html#cb32-242"></a>                filename)</span>
<span id="cb32-243"><a href="d-plots.html#cb32-243"></a>  }</span>
<span id="cb32-244"><a href="d-plots.html#cb32-244"></a>}</span></code></pre></div>
</div>
<div id="draping-zones-over-dem" class="section level2">
<h2><span class="header-section-number">9.2</span> Draping zones over DEM</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="d-plots.html#cb33-1"></a><span class="co">#Drape function</span></span>
<span id="cb33-2"><a href="d-plots.html#cb33-2"></a><span class="kw">names</span>(all.list)</span>
<span id="cb33-3"><a href="d-plots.html#cb33-3"></a>drape &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">site =</span> <span class="st">&#39;Spruce&#39;</span>,</span>
<span id="cb33-4"><a href="d-plots.html#cb33-4"></a>                  <span class="dt">filename =</span> filename){</span>
<span id="cb33-5"><a href="d-plots.html#cb33-5"></a>  </span>
<span id="cb33-6"><a href="d-plots.html#cb33-6"></a>  stack &lt;-<span class="st"> </span>all.list[[site]]</span>
<span id="cb33-7"><a href="d-plots.html#cb33-7"></a>  </span>
<span id="cb33-8"><a href="d-plots.html#cb33-8"></a>  newfac &lt;-<span class="st"> </span>stack[[<span class="dv">9</span>]]</span>
<span id="cb33-9"><a href="d-plots.html#cb33-9"></a>  oldfac &lt;-<span class="st"> </span>stack[[<span class="dv">10</span>]]</span>
<span id="cb33-10"><a href="d-plots.html#cb33-10"></a>  newdem &lt;-<span class="st"> </span>stack[[<span class="dv">1</span>]]</span>
<span id="cb33-11"><a href="d-plots.html#cb33-11"></a>  olddem &lt;-<span class="st"> </span>stack[[<span class="dv">4</span>]]</span>
<span id="cb33-12"><a href="d-plots.html#cb33-12"></a>  </span>
<span id="cb33-13"><a href="d-plots.html#cb33-13"></a>  <span class="cf">if</span>(<span class="kw">grepl</span>(<span class="st">&#39;Ref&#39;</span>,site)){</span>
<span id="cb33-14"><a href="d-plots.html#cb33-14"></a>    type =<span class="st"> &#39;Unmined&#39;</span></span>
<span id="cb33-15"><a href="d-plots.html#cb33-15"></a></span>
<span id="cb33-16"><a href="d-plots.html#cb33-16"></a>  }<span class="cf">else</span> {</span>
<span id="cb33-17"><a href="d-plots.html#cb33-17"></a>  type =<span class="st"> &#39;Mined&#39;</span></span>
<span id="cb33-18"><a href="d-plots.html#cb33-18"></a>  }</span>
<span id="cb33-19"><a href="d-plots.html#cb33-19"></a>  </span>
<span id="cb33-20"><a href="d-plots.html#cb33-20"></a>  </span>
<span id="cb33-21"><a href="d-plots.html#cb33-21"></a>  <span class="cf">if</span>(site <span class="op">==</span><span class="st"> &#39;WhiteRef&#39;</span> <span class="op">&amp;</span><span class="st"> </span>type <span class="op">==</span><span class="st"> &#39;Unmined&#39;</span>){</span>
<span id="cb33-22"><a href="d-plots.html#cb33-22"></a>    site1 =<span class="st"> &#39;WhiteOakRef&#39;</span></span>
<span id="cb33-23"><a href="d-plots.html#cb33-23"></a>  }<span class="cf">else</span>{site1 =<span class="st"> </span>site}</span>
<span id="cb33-24"><a href="d-plots.html#cb33-24"></a>  </span>
<span id="cb33-25"><a href="d-plots.html#cb33-25"></a>  <span class="kw">unique</span>(sa.breaks<span class="op">$</span>Site)</span>
<span id="cb33-26"><a href="d-plots.html#cb33-26"></a>  sa.new &lt;-<span class="st"> </span>sa.breaks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-27"><a href="d-plots.html#cb33-27"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> </span>site1,</span>
<span id="cb33-28"><a href="d-plots.html#cb33-28"></a>           Type <span class="op">==</span><span class="st"> </span>type,</span>
<span id="cb33-29"><a href="d-plots.html#cb33-29"></a>           Data.Source <span class="op">==</span><span class="st"> &#39;Current&#39;</span>)</span>
<span id="cb33-30"><a href="d-plots.html#cb33-30"></a>  </span>
<span id="cb33-31"><a href="d-plots.html#cb33-31"></a></span>
<span id="cb33-32"><a href="d-plots.html#cb33-32"></a>  sa.old &lt;-<span class="st"> </span>sa.breaks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-33"><a href="d-plots.html#cb33-33"></a><span class="st">      </span>dplyr<span class="op">::</span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> </span>site1,</span>
<span id="cb33-34"><a href="d-plots.html#cb33-34"></a>           Type<span class="op">==</span>type,</span>
<span id="cb33-35"><a href="d-plots.html#cb33-35"></a>           Data.Source <span class="op">==</span><span class="st"> &#39;Historic&#39;</span>)</span>
<span id="cb33-36"><a href="d-plots.html#cb33-36"></a></span>
<span id="cb33-37"><a href="d-plots.html#cb33-37"></a> </span>
<span id="cb33-38"><a href="d-plots.html#cb33-38"></a>  newzones &lt;-<span class="st"> </span><span class="kw">cut</span>(newfac,<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">0</span>,sa.new<span class="op">$</span>value<span class="op">/</span><span class="dv">10</span>,<span class="kw">maxValue</span>(newfac))) <span class="op">%&gt;%</span></span>
<span id="cb33-39"><a href="d-plots.html#cb33-39"></a><span class="st">    </span><span class="kw">as.matrix</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>()</span>
<span id="cb33-40"><a href="d-plots.html#cb33-40"></a>  </span>
<span id="cb33-41"><a href="d-plots.html#cb33-41"></a>  </span>
<span id="cb33-42"><a href="d-plots.html#cb33-42"></a>  oldzones &lt;-<span class="st"> </span><span class="kw">cut</span>(oldfac,<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">0</span>,sa.old<span class="op">$</span>value<span class="op">/</span><span class="dv">10</span>,<span class="kw">maxValue</span>(oldfac))) <span class="op">%&gt;%</span></span>
<span id="cb33-43"><a href="d-plots.html#cb33-43"></a><span class="st">    </span><span class="kw">as.matrix</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>()</span>
<span id="cb33-44"><a href="d-plots.html#cb33-44"></a>  </span>
<span id="cb33-45"><a href="d-plots.html#cb33-45"></a>  zlims &lt;-<span class="st"> </span><span class="kw">lim</span>(olddem,newdem)</span>
<span id="cb33-46"><a href="d-plots.html#cb33-46"></a></span>
<span id="cb33-47"><a href="d-plots.html#cb33-47"></a>  zone.cols &lt;-<span class="st"> </span><span class="kw">rev</span>(RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">4</span>,<span class="st">&#39;BrBG&#39;</span>))</span>
<span id="cb33-48"><a href="d-plots.html#cb33-48"></a>   <span class="co">#OldDEM</span></span>
<span id="cb33-49"><a href="d-plots.html#cb33-49"></a>  l.dist &lt;-<span class="st"> </span><span class="fl">-0.05</span></span>
<span id="cb33-50"><a href="d-plots.html#cb33-50"></a>  theta &lt;-<span class="st"> </span><span class="fl">-90.5</span></span>
<span id="cb33-51"><a href="d-plots.html#cb33-51"></a>  phi &lt;-<span class="st"> </span><span class="dv">45</span></span>
<span id="cb33-52"><a href="d-plots.html#cb33-52"></a>  shade=.<span class="dv">65</span></span>
<span id="cb33-53"><a href="d-plots.html#cb33-53"></a>  lphi=<span class="dv">0</span></span>
<span id="cb33-54"><a href="d-plots.html#cb33-54"></a>  ltheta=<span class="op">-</span><span class="dv">135</span></span>
<span id="cb33-55"><a href="d-plots.html#cb33-55"></a>  </span>
<span id="cb33-56"><a href="d-plots.html#cb33-56"></a>  old.m.na &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(olddem)</span>
<span id="cb33-57"><a href="d-plots.html#cb33-57"></a>  new.m.na &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(newdem)</span>
<span id="cb33-58"><a href="d-plots.html#cb33-58"></a>  olddem[<span class="kw">is.na</span>(olddem)] &lt;-<span class="st"> </span><span class="kw">minValue</span>(olddem)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb33-59"><a href="d-plots.html#cb33-59"></a>  newdem[<span class="kw">is.na</span>(newdem)] &lt;-<span class="st"> </span><span class="kw">minValue</span>(newdem)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb33-60"><a href="d-plots.html#cb33-60"></a>  old.m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(olddem)</span>
<span id="cb33-61"><a href="d-plots.html#cb33-61"></a>  new.m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(newdem)</span>
<span id="cb33-62"><a href="d-plots.html#cb33-62"></a>  x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(old.m)<span class="op">*</span><span class="dv">10</span></span>
<span id="cb33-63"><a href="d-plots.html#cb33-63"></a>  y &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(old.m)<span class="op">*</span><span class="dv">10</span></span>
<span id="cb33-64"><a href="d-plots.html#cb33-64"></a>  </span>
<span id="cb33-65"><a href="d-plots.html#cb33-65"></a>  <span class="kw">png</span>(<span class="dt">filename=</span>filename,<span class="dt">width=</span><span class="dv">9</span>,<span class="dt">height=</span><span class="dv">4</span>,<span class="dt">units=</span><span class="st">&#39;in&#39;</span>,<span class="dt">res=</span><span class="dv">300</span>)</span>
<span id="cb33-66"><a href="d-plots.html#cb33-66"></a>    <span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">mgp=</span><span class="kw">c</span>(<span class="fl">1.8</span>,<span class="fl">0.5</span>,<span class="dv">0</span>),<span class="dt">cex=</span><span class="fl">1.5</span>,<span class="dt">cex.lab=</span><span class="fl">1.5</span>,<span class="dt">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb33-67"><a href="d-plots.html#cb33-67"></a>    </span>
<span id="cb33-68"><a href="d-plots.html#cb33-68"></a>    mx1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>),<span class="dv">1</span>,<span class="dv">8</span>,<span class="dt">byrow=</span>T)</span>
<span id="cb33-69"><a href="d-plots.html#cb33-69"></a>    <span class="kw">layout</span>(mx1)</span>
<span id="cb33-70"><a href="d-plots.html#cb33-70"></a>    </span>
<span id="cb33-71"><a href="d-plots.html#cb33-71"></a>    </span>
<span id="cb33-72"><a href="d-plots.html#cb33-72"></a>    <span class="co">## Old Zones, Top Left</span></span>
<span id="cb33-73"><a href="d-plots.html#cb33-73"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb33-74"><a href="d-plots.html#cb33-74"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elev. (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb33-75"><a href="d-plots.html#cb33-75"></a>            <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb33-76"><a href="d-plots.html#cb33-76"></a>    </span>
<span id="cb33-77"><a href="d-plots.html#cb33-77"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>old.m.na,<span class="dt">col=</span>zone.cols,</span>
<span id="cb33-78"><a href="d-plots.html#cb33-78"></a>            <span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">side=</span><span class="dv">4</span>,<span class="dt">line.clab=</span><span class="dv">1</span>,<span class="dt">dist=</span>l.dist,<span class="dt">width=</span><span class="fl">0.75</span>,<span class="dt">length=</span><span class="fl">0.5</span>,<span class="dt">mgp=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="fl">0.6</span>,<span class="dv">0</span>),<span class="dt">at=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>),</span>
<span id="cb33-79"><a href="d-plots.html#cb33-79"></a>            <span class="dt">lighting=</span>F,<span class="dt">add=</span>T,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb33-80"><a href="d-plots.html#cb33-80"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="fl">0.6</span>,<span class="dt">clab=</span><span class="st">&#39;Domain&#39;</span>,<span class="dt">expand=</span><span class="dv">2</span>,</span>
<span id="cb33-81"><a href="d-plots.html#cb33-81"></a>            <span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">colvar=</span>oldzones)</span>
<span id="cb33-82"><a href="d-plots.html#cb33-82"></a>    </span>
<span id="cb33-83"><a href="d-plots.html#cb33-83"></a>    <span class="co">#New zones</span></span>
<span id="cb33-84"><a href="d-plots.html#cb33-84"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray30&#39;</span>),<span class="dt">lighting=</span>T,<span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span><span class="ot">FALSE</span>),<span class="dt">theta=</span>theta,<span class="dt">phi=</span>phi,</span>
<span id="cb33-85"><a href="d-plots.html#cb33-85"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="dv">1</span>,<span class="dt">clab=</span><span class="st">&#39;Elev. (m)&#39;</span>,<span class="dt">axes=</span>F,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb33-86"><a href="d-plots.html#cb33-86"></a>            <span class="dt">ticktype=</span><span class="st">&#39;detailed&#39;</span>,<span class="dt">xlab=</span><span class="st">&#39;North (m)&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;East (m)&#39;</span>,<span class="dt">zlab=</span><span class="st">&#39;Elev (m)&#39;</span>,<span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">expand=</span><span class="dv">2</span>)</span>
<span id="cb33-87"><a href="d-plots.html#cb33-87"></a>    </span>
<span id="cb33-88"><a href="d-plots.html#cb33-88"></a>    <span class="kw">persp3D</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">z=</span>new.m.na,<span class="dt">col=</span>zone.cols,</span>
<span id="cb33-89"><a href="d-plots.html#cb33-89"></a>            <span class="dt">colkey=</span><span class="kw">list</span>(<span class="dt">plot=</span>F),</span>
<span id="cb33-90"><a href="d-plots.html#cb33-90"></a>            <span class="dt">lighting=</span>F,<span class="dt">add=</span>T,<span class="dt">zlim=</span>zlims,<span class="dt">box=</span>F,</span>
<span id="cb33-91"><a href="d-plots.html#cb33-91"></a>            <span class="dt">scale =</span> <span class="ot">FALSE</span>, <span class="dt">shade =</span> <span class="fl">0.6</span>,<span class="dt">clab=</span><span class="st">&#39;Domain&#39;</span>,<span class="dt">expand=</span><span class="dv">2</span>,</span>
<span id="cb33-92"><a href="d-plots.html#cb33-92"></a>            <span class="dt">inttype=</span><span class="dv">2</span>,<span class="dt">colvar=</span>newzones)</span>
<span id="cb33-93"><a href="d-plots.html#cb33-93"></a>    </span>
<span id="cb33-94"><a href="d-plots.html#cb33-94"></a>    area =<span class="st"> </span><span class="kw">round</span>(<span class="kw">length</span>(new.m.na)<span class="op">/</span>(<span class="dv">10000</span>),<span class="dv">0</span>)</span>
<span id="cb33-95"><a href="d-plots.html#cb33-95"></a>    </span>
<span id="cb33-96"><a href="d-plots.html#cb33-96"></a>    label =<span class="st"> </span><span class="kw">bquote</span>(.(sites[i]) <span class="op">~</span><span class="st"> &#39;-&#39;</span> <span class="op">~</span><span class="st"> </span>.({area}) <span class="op">~</span><span class="st"> </span>km<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb33-97"><a href="d-plots.html#cb33-97"></a>    </span>
<span id="cb33-98"><a href="d-plots.html#cb33-98"></a>    <span class="cf">if</span>(site <span class="op">!=</span><span class="st"> &#39;Spruce&#39;</span>){</span>
<span id="cb33-99"><a href="d-plots.html#cb33-99"></a>    <span class="kw">mtext</span>(label, <span class="dt">side =</span> <span class="dv">3</span>, <span class="dt">line =</span> <span class="dv">-3</span>,</span>
<span id="cb33-100"><a href="d-plots.html#cb33-100"></a>          <span class="dt">cex =</span> <span class="dv">1</span>)</span>
<span id="cb33-101"><a href="d-plots.html#cb33-101"></a>    }</span>
<span id="cb33-102"><a href="d-plots.html#cb33-102"></a>    </span>
<span id="cb33-103"><a href="d-plots.html#cb33-103"></a>    <span class="co">## Count histogram</span></span>
<span id="cb33-104"><a href="d-plots.html#cb33-104"></a>    </span>
<span id="cb33-105"><a href="d-plots.html#cb33-105"></a>    hmax =<span class="st"> </span><span class="kw">ceiling</span>(<span class="kw">max</span>(<span class="kw">c</span>(<span class="kw">table</span>(newzones),<span class="kw">table</span>(oldzones)))<span class="op">/</span><span class="dv">10000</span>)<span class="op">*</span><span class="dv">10000</span></span>
<span id="cb33-106"><a href="d-plots.html#cb33-106"></a>    hseq =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,hmax,<span class="dt">length.out =</span> <span class="dv">3</span>)</span>
<span id="cb33-107"><a href="d-plots.html#cb33-107"></a></span>
<span id="cb33-108"><a href="d-plots.html#cb33-108"></a>    </span>
<span id="cb33-109"><a href="d-plots.html#cb33-109"></a>    <span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb33-110"><a href="d-plots.html#cb33-110"></a>    <span class="kw">hist</span>(oldzones,<span class="dt">col=</span><span class="st">&#39;blue&#39;</span>,</span>
<span id="cb33-111"><a href="d-plots.html#cb33-111"></a>      <span class="dt">xlab=</span><span class="st">&#39;Domain&#39;</span>,</span>
<span id="cb33-112"><a href="d-plots.html#cb33-112"></a>      <span class="dt">ylab=</span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;Area (&#39;</span>,km<span class="op">^</span><span class="dv">2</span>,<span class="st">&#39;)&#39;</span>)),</span>
<span id="cb33-113"><a href="d-plots.html#cb33-113"></a>      <span class="dt">main=</span><span class="st">&#39;&#39;</span>,<span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>,<span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>,</span>
<span id="cb33-114"><a href="d-plots.html#cb33-114"></a>      <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,hmax))</span>
<span id="cb33-115"><a href="d-plots.html#cb33-115"></a>    <span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),<span class="dt">padj=</span><span class="dv">0</span>,<span class="dt">line=</span><span class="op">-</span>.<span class="dv">8</span>)</span>
<span id="cb33-116"><a href="d-plots.html#cb33-116"></a>    <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> hseq,<span class="dt">labels =</span>  <span class="kw">round</span>(hseq<span class="op">/</span><span class="dv">10000</span>,<span class="dv">1</span>))</span>
<span id="cb33-117"><a href="d-plots.html#cb33-117"></a>    <span class="kw">hist</span>(newzones,<span class="dt">col=</span>reds2,</span>
<span id="cb33-118"><a href="d-plots.html#cb33-118"></a>      <span class="dt">xlab=</span><span class="st">&#39;Domain&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;Frequency&#39;</span>,<span class="dt">main=</span><span class="st">&#39;&#39;</span>,<span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>,<span class="dt">density=</span><span class="dv">40</span>,<span class="dt">add=</span>T)</span>
<span id="cb33-119"><a href="d-plots.html#cb33-119"></a>    </span>
<span id="cb33-120"><a href="d-plots.html#cb33-120"></a>    <span class="kw">legend</span>(<span class="dt">x=</span><span class="fl">2.2</span>,<span class="dt">y=</span><span class="dv">30000</span>,<span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">15</span>,<span class="dv">15</span>),<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;gray20&#39;</span>,reds2),<span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&#39;Pre-Mining&#39;</span>,<span class="st">&#39;Post-Mining&#39;</span>))</span>
<span id="cb33-121"><a href="d-plots.html#cb33-121"></a>  <span class="kw">dev.off</span>()</span>
<span id="cb33-122"><a href="d-plots.html#cb33-122"></a>}</span>
<span id="cb33-123"><a href="d-plots.html#cb33-123"></a></span>
<span id="cb33-124"><a href="d-plots.html#cb33-124"></a></span>
<span id="cb33-125"><a href="d-plots.html#cb33-125"></a></span>
<span id="cb33-126"><a href="d-plots.html#cb33-126"></a></span>
<span id="cb33-127"><a href="d-plots.html#cb33-127"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(sites)){</span>
<span id="cb33-128"><a href="d-plots.html#cb33-128"></a>  <span class="kw">print</span>(sites[i])</span>
<span id="cb33-129"><a href="d-plots.html#cb33-129"></a>  filename =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;Figures2018/3d_drape/&#39;</span>,sites[i],<span class="st">&#39;Zone_Drape.png&#39;</span>)</span>
<span id="cb33-130"><a href="d-plots.html#cb33-130"></a>  </span>
<span id="cb33-131"><a href="d-plots.html#cb33-131"></a>  <span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(filename)){</span>
<span id="cb33-132"><a href="d-plots.html#cb33-132"></a>  <span class="kw">drape</span>(<span class="dt">site =</span> sites[i],</span>
<span id="cb33-133"><a href="d-plots.html#cb33-133"></a>                filename)</span>
<span id="cb33-134"><a href="d-plots.html#cb33-134"></a>  }</span>
<span id="cb33-135"><a href="d-plots.html#cb33-135"></a>}</span></code></pre></div>
</div>
<div id="distribution-of-process-zones-by-site" class="section level2">
<h2><span class="header-section-number">9.3</span> Distribution of process zones by site</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="d-plots.html#cb34-1"></a>sa.break.wide &lt;-<span class="st"> </span>sa.breaks <span class="op">%&gt;%</span></span>
<span id="cb34-2"><a href="d-plots.html#cb34-2"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Watershed=</span>Site) <span class="op">%&gt;%</span></span>
<span id="cb34-3"><a href="d-plots.html#cb34-3"></a><span class="st">  </span><span class="kw">group_by</span>(Watershed,Type,Data.Source) <span class="op">%&gt;%</span></span>
<span id="cb34-4"><a href="d-plots.html#cb34-4"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></span>
<span id="cb34-5"><a href="d-plots.html#cb34-5"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">break.data=</span>data)</span>
<span id="cb34-6"><a href="d-plots.html#cb34-6"></a></span>
<span id="cb34-7"><a href="d-plots.html#cb34-7"></a></span>
<span id="cb34-8"><a href="d-plots.html#cb34-8"></a>sa.cutter &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</span>
<span id="cb34-9"><a href="d-plots.html#cb34-9"></a>  df &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span></span>
<span id="cb34-10"><a href="d-plots.html#cb34-10"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">zones=</span><span class="kw">cut</span>(x<span class="op">$</span>area.m2,<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">0</span>,y<span class="op">$</span>value,<span class="kw">max</span>(x<span class="op">$</span>area.m2)),</span>
<span id="cb34-11"><a href="d-plots.html#cb34-11"></a>                               <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&#39;I&#39;</span>,<span class="st">&#39;II&#39;</span>,<span class="st">&#39;III&#39;</span>,<span class="st">&#39;IV&#39;</span>)))</span>
<span id="cb34-12"><a href="d-plots.html#cb34-12"></a>  <span class="kw">return</span>(df)</span>
<span id="cb34-13"><a href="d-plots.html#cb34-13"></a>}</span>
<span id="cb34-14"><a href="d-plots.html#cb34-14"></a></span>
<span id="cb34-15"><a href="d-plots.html#cb34-15"></a></span>
<span id="cb34-16"><a href="d-plots.html#cb34-16"></a>sa.zones &lt;-<span class="st"> </span>long.df <span class="op">%&gt;%</span></span>
<span id="cb34-17"><a href="d-plots.html#cb34-17"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(fdr.type<span class="op">==</span><span class="st">&#39;f.inf&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb34-18"><a href="d-plots.html#cb34-18"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(Data<span class="op">==</span><span class="st">&#39;UAA&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb34-19"><a href="d-plots.html#cb34-19"></a><span class="st">  </span><span class="kw">select</span>(Site,<span class="dt">UAA=</span>value,Watershed,Type,Data.Source) <span class="op">%&gt;%</span></span>
<span id="cb34-20"><a href="d-plots.html#cb34-20"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">area.m2 =</span> <span class="kw">round</span>(UAA<span class="op">*</span><span class="dv">10</span>,<span class="dv">2</span>)) <span class="op">%&gt;%</span></span>
<span id="cb34-21"><a href="d-plots.html#cb34-21"></a><span class="st">  </span><span class="kw">group_by</span>(Watershed,Type,Data.Source) <span class="op">%&gt;%</span></span>
<span id="cb34-22"><a href="d-plots.html#cb34-22"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></span>
<span id="cb34-23"><a href="d-plots.html#cb34-23"></a><span class="st">  </span><span class="kw">left_join</span>(sa.break.wide,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;Watershed&#39;</span>,<span class="st">&#39;Type&#39;</span>,<span class="st">&#39;Data.Source&#39;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb34-24"><a href="d-plots.html#cb34-24"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cut.df =</span> <span class="kw">map2</span>(data,break.data,sa.cutter)) <span class="op">%&gt;%</span></span>
<span id="cb34-25"><a href="d-plots.html#cb34-25"></a><span class="st">  </span><span class="kw">unnest</span>(cut.df) <span class="op">%&gt;%</span></span>
<span id="cb34-26"><a href="d-plots.html#cb34-26"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb34-27"><a href="d-plots.html#cb34-27"></a><span class="st">  </span><span class="kw">group_by</span>(Watershed,Type,Data.Source,zones)<span class="op">%&gt;%</span></span>
<span id="cb34-28"><a href="d-plots.html#cb34-28"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">area.km2 =</span> <span class="kw">n</span>()<span class="op">/</span><span class="dv">10000</span>) <span class="op">%&gt;%</span></span>
<span id="cb34-29"><a href="d-plots.html#cb34-29"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb34-30"><a href="d-plots.html#cb34-30"></a></span>
<span id="cb34-31"><a href="d-plots.html#cb34-31"></a></span>
<span id="cb34-32"><a href="d-plots.html#cb34-32"></a>sa.zones <span class="op">%&gt;%</span></span>
<span id="cb34-33"><a href="d-plots.html#cb34-33"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>zones,<span class="dt">y=</span>area.km2,<span class="dt">fill=</span><span class="kw">interaction</span>(Data.Source,Type))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-34"><a href="d-plots.html#cb34-34"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&#39;identity&#39;</span>,<span class="dt">position=</span><span class="st">&#39;dodge&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-35"><a href="d-plots.html#cb34-35"></a><span class="st">  </span><span class="kw">facet_grid</span>(Type<span class="op">~</span>Watershed) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-36"><a href="d-plots.html#cb34-36"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">name=</span><span class="st">&#39;Data Source&#39;</span>,<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;Orange3&#39;</span>,<span class="st">&#39;Purple4&#39;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-37"><a href="d-plots.html#cb34-37"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&#39;top&#39;</span>,<span class="dt">legend.direction=</span><span class="st">&#39;horizontal&#39;</span>)</span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="energy-index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="table-of-stats-by-zone.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
